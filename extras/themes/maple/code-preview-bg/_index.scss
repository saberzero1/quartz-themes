body:not(.code-preview-bg) .setting-item[data-id="setting-code-bg-outer"] {
  display: none;
}

body:not(.code-preview-bg)
  .setting-item[data-id="setting-code-bg-outer"]
  + .style-settings-container {
  display: none;
}

.code-preview-bg {
  --code-bg-s: 50%;
  --code-bg-l: 85%;
}

.code-preview-bg
  .markdown-preview-view
  .markdown-preview-section
  div:has(> pre:not([class*="frontmatter"])) {
  padding: var(--size-4-4) var(--size-4-8);
  margin-block: var(--size-4-4);
  border-radius: var(--setting-code-bg-radius);
  background-image: var(
    --setting-code-bg-outer,
    linear-gradient(
      -30deg,
      hsl(calc(var(--accent-h) + 145), var(--code-bg-s), var(--code-bg-l)),
      hsl(calc(var(--accent-h) + 115), var(--code-bg-s), var(--code-bg-l)),
      hsl(calc(var(--accent-h) + 90), var(--code-bg-s), var(--code-bg-l)),
      hsl(calc(var(--accent-h) + 65), var(--code-bg-s), var(--code-bg-l)),
      hsl(calc(var(--accent-h) + 35), var(--code-bg-s), var(--code-bg-l))
    )
  );
}

.code-preview-bg .markdown-preview-view .markdown-preview-section pre:not([class*="frontmatter"]) {
  --code-background: var(--setting-code-bg, hsl(var(--background-secondary-hsl)));
  border-width: 0;
}
