body.theme-setting-overrideExcalidraw {
  .workspace-leaf-content[data-type='excalidraw'] {
    & .view-header {
      padding-bottom: 0;
    }
    & .excalidraw-view {
      /* I don't know why the default styles have 1px padding left and right. */
      padding: 0;
    }
  }
  .excalidraw-view {
    & .excalidraw {
      .FixedSideContainer_side_top {
        top: var(--theme-length-controlSetSpacing) !important;
        right: var(--theme-length-controlSetSpacing) !important;
        bottom: var(--theme-length-controlSetSpacing) !important;
        left: var(--theme-length-controlSetSpacing) !important;
      }
      .App-bottom-bar {
        gap: 0.5rem;
        margin: var(--theme-length-controlSetSpacing) !important;
      }

      /* Control sets */
      & .Island,
      & .mobile-misc-tools-container {
        background: var(--theme-color-controlSetBg);
        border: none;
        padding: 0.25rem;
        gap: 0;
        box-shadow: var(--theme-shadow-input);
        border-radius: var(--radius-m);
      }
      & .mobile-misc-tools-container {
        gap: 0.5rem;
        right: 0;
        top: 0;
      }

      /* Layout structures inside control sets */
      & .Stack,
      & .App-toolbar-content {
        gap: 0.5em;
        padding: 0;
      }
      /* I think these are supposed to be spacers, but I don't think we need them. */
      & .App-toolbar-content > .ToolIcon__icon:empty {
        display: none;
      }

      /* Menus */
      & .dropdown-menu--mobile {
        width: auto;
      }
      & .dropdown-menu .dropdown-menu-container {
        background-color: var(--theme-color-menuBg);
        border: 0;
        box-shadow: var(--shadow-l);
        border-radius: var(--radius-l);
        margin: 0 1rem;
        padding: 0.5em;

        & > button {
          border: none;
          border-color: var(--nav-item-color);
          color: var(--nav-item-color);
          background-color: var(--nav-item-background);
          box-shadow: none;
        }

        /* Match other hotkeys */
        & .dropdown-menu-item__shortcut {
          background: transparent;
          border: solid 1px var(--theme-color-hotkey);
          color: var(--theme-color-hotkey);
          font-size: var(--font-ui-smaller);
          font-family: var(--font-interface);
          padding: 2px 6px;
          border-radius: var(--radius-s);
        }
      }
    }
  }
  @media (hover: hover) {
    .excalidraw-view {
      & .excalidraw {
        & .dropdown-menu .dropdown-menu-container {
          & > button:hover {
            border-color: var(--nav-item-color-hover);
            color: var(--nav-item-color-hover);
            background-color: var(--nav-item-background-hover) !important;
            font-weight: var(--nav-item-weight-hover);
            --icon-fill-color: var(--nav-item-color-hover);
          }

          & .dropdown-menu-item__shortcut {
            color: inherit;
            border-color: inherit;
          }
        }
      }
    }
  }
  /* Patch weird use of .is-mobile that clashes with Obsidian's use */
  body:not(.is-mobile) .mobile-misc-tools-container .ToolIcon.is-mobile {
    --input-height: 30px;
  }
  /* Buttons â€“ duplicated from lightweight buttons above */
  .excalidraw-view .excalidraw .ToolIcon,
  .excalidraw-view .excalidraw .dropdown-menu-button,
  .excalidraw-view .excalidraw .sidebar-trigger__label-element {
    align-items: center;
    background-color: transparent;
    border-radius: var(--clickable-icon-radius);
    border: none;
    box-shadow: none;
    color: var(--theme-color-control);
    cursor: var(--cursor);
    display: flex;
    height: 2em;
    justify-content: center;
    min-height: var(--input-height);
    opacity: var(--icon-opacity);
    padding: 0.25rem;
    text-decoration: none;
    transition: opacity 0.15s ease-in-out;
    width: 2em;
    --icon-fill-color: var(--theme-color-control);
  }
  .is-mobile .excalidraw-view .excalidraw .ToolIcon,
  .is-mobile .excalidraw-view .excalidraw .dropdown-menu-button {
    min-height: 44px;
    min-width: 44px;
  }
  .excalidraw-view .excalidraw .dropdown-menu-button:focus {
    box-shadow: none;
  }
  @media (hover: hover) {
    .excalidraw-view .excalidraw .Island .ToolIcon:hover,
    .excalidraw-view .excalidraw .dropdown-menu-button:hover,
    .excalidraw-view .excalidraw .sidebar-trigger__label-element:hover,
    .excalidraw-view .excalidraw .mobile-misc-tools-container .ToolIcon:hover,
    .excalidraw-view .excalidraw .reset-zoom-button:hover {
      color: var(--theme-color-controlHover);
      --icon-fill-color: var(--theme-color-controlHover);
      background-color: var(--background-modifier-hover);
    }
  }
  /* Active state */
  .excalidraw-view .excalidraw .ToolIcon:has(.ToolIcon_type_radio:checked),
  .excalidraw-view .excalidraw .dropdown-menu-button:has(~ .dropdown-menu) {
    opacity: var(--icon-opacity-hover);
    color: var(--theme-color-controlLightweightActive);
    background-color: var(--theme-color-interactiveActive);
    --icon-fill-color: var(--theme-color-controlLightweightActive);
  }
  .excalidraw-view
    .excalidraw
    .ToolIcon.fillable:has(.ToolIcon_type_radio:checked)
    .ToolIcon__icon,
  .excalidraw-view
    .excalidraw
    .ToolIcon.fillable:has(.ToolIcon_type_radio:checked)
    .ToolIcon__keybinding,
  .excalidraw .ToolIcon .ToolIcon_type_checkbox:checked + .ToolIcon__icon,
  .excalidraw .ToolIcon .ToolIcon_type_radio:checked + .ToolIcon__icon {
    color: inherit;
    --icon-fill-color: inherit;
  }
  @media (hover: hover) {
    .excalidraw-view .excalidraw .ToolIcon:hover,
    .excalidraw-view .excalidraw .dropdown-menu-button:hover {
      color: var(--theme-color-controlHover);
      background-color: var(--background-modifier-hover);
    }
    .excalidraw-view
      .excalidraw
      .ToolIcon:has(.ToolIcon_type_radio:checked):hover,
    .excalidraw-view .excalidraw .dropdown-menu-button:focus:hover {
      background-color: var(--background-modifier-hover);
      color: var(--theme-color-controlHover);
    }
  }
  .excalidraw-view
    .excalidraw
    .ToolIcon
    .ToolIcon_type_checkbox:checked
    + .ToolIcon__icon,
  .excalidraw-view
    .excalidraw
    .ToolIcon
    .ToolIcon_type_radio:checked
    + .ToolIcon__icon {
    background-color: transparent;
  }
  /* Icons inside buttons */
  .excalidraw-view .excalidraw .Island .ToolIcon__icon,
  .excalidraw-view .excalidraw .Island .ToolIcon__keybinding,
  .excalidraw-view .excalidraw .mobile-misc-tools-container .ToolIcon__icon {
    --icon-size: var(--icon-s);
    --icon-stroke: var(--icon-s-stroke-width);
    border-radius: var(--clickable-icon-radius);
    color: inherit;
    opacity: var(--icon-opacity);
    background-color: transparent;
    border: none;
  }
  .excalidraw-view .excalidraw .sidebar-trigger {
    box-shadow: none;
    background: transparent;
  }
  .excalidraw-view .excalidraw .App-toolbar__divider {
    width: 1rem;
    height: 1.5rem;
    align-self: center;
    background-color: transparent;
    margin: 0 0.25rem;
  }
  .excalidraw-view .excalidraw .ToolIcon {
    cursor: default;
  }
  .excalidraw-view .excalidraw .zoom-actions,
  .excalidraw-view .excalidraw .zoom-actions .Stack {
    background-color: transparent;
    border-radius: 0;
    box-shadow: none;
    padding: 0;
  }
  .excalidraw-view .excalidraw .zoom-button {
    background: transparent !important; /* Ugh. */
    border-radius: var(--clickable-icon-radius) !important;
    font-size: inherit !important;
  }
  @media (hover: hover) {
    .excalidraw-view .excalidraw .zoom-button:hover {
      background-color: var(--background-modifier-hover) !important; /* Ugh. */
    }
  }
  /* Match style of small notice */
  .excalidraw .HintViewer {
    border-radius: var(--radius-xl);
    background-color: var(--background-modifier-message);
    color: var(--theme-color-notice);
    box-shadow: var(--shadow-s);
    padding: 0.5em 0.75em;
    width: auto;

    & span {
      padding: 0;
    }
  }
}
