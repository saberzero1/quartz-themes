const themeList = [
  "80s-neon",
  "abate",
  "abecedarium",
  "absolutegruv",
  "abyssal",
  "adrenaline",
  "adwaita",
  "agate",
  "aged-whisky",
  "al-dente",
  "allium",
  "amoled-serenity",
  "anuppuccin",
  "apatheia",
  "apex",
  "arcane",
  "arzaba",
  "atom",
  "atomus",
  "aura",
  "aura-dark",
  "aurora",
  "aurora-twilight",
  "autotape",
  "avatar",
  "ayu-light-mirage",
  "ayu-mirage",
  "azure",
  "base2tone",
  "baseline",
  "behave-dark",
  "big-bold",
  "black",
  "blackbird",
  "blood-rush",
  "blossom",
  "blue-topaz",
  "bolt",
  "border",
  "borealis",
  "bossidian",
  "brainhack",
  "brutalism",
  "buena-vista",
  "camena",
  "carbon",
  "cardstock",
  "catppuccin",
  "celestial-night",
  "charcoal",
  "chiaroscuroflow",
  "chime",
  "christmas",
  "cobalt-peacock",
  "cocoa",
  "coffee",
  "colored-candy",
  "comfort",
  "comfort-color-dark",
  "comfort-dark",
  "comfort-smooth",
  "composer",
  "consolas",
  "covert",
  "creature",
  "creme-brulee",
  "cupertino",
  "cyber-glow",
  "cybertron",
  "cybertron-shifted",
  "dark-castle",
  "dark-clarity",
  "dark-graphite",
  "dark-graphite-pie",
  "dark-moss",
  "darkember",
  "darkyan",
  "dashboard",
  "dawn",
  "dayspring",
  "deep-submerge",
  "deeper-work",
  "default",
  "dekurai",
  "discordian",
  "dracula-for-obsidian",
  "dracula-gemini",
  "dracula-lyt",
  "dracula-official",
  "dracula-plus",
  "dracula-slim",
  "duality",
  "dune",
  "dunite",
  "dust",
  "dynamic-color",
  "ebullientworks",
  "eldritch",
  "elegance",
  "emerald-echo",
  "encore",
  "enhanced-file-explorer-tree",
  "ethereon",
  "evangelion",
  "everblush",
  "everforest",
  "everforest-enchanted",
  "everforest-spruce",
  "evergreen-shadow",
  "evilred",
  "faded",
  "fancy-a-story",
  "fastppuccin",
  "feather",
  "firefly",
  "flatcap",
  "flexcyon",
  "flexoki",
  "flexoki-warm",
  "focus",
  "frost",
  "fusion",
  "future",
  "garden-gnome-adwaita-gtk",
  "gdct",
  "gdct-dark",
  "github-theme",
  "githubdhc",
  "gitsidian",
  "glass-robo",
  "golden-topaz",
  "green-nightmare",
  "gummy-revived",
  "hackthebox",
  "halcyon",
  "handwriting-kalam",
  "heboric",
  "hipstersmoothie",
  "hojicha",
  "hulk",
  "ia-writer",
  "ib-writer",
  "iceberg",
  "improved-potato",
  "ink",
  "ion",
  "iridium",
  "its-theme",
  "jotter",
  "kakano",
  "kanagawa",
  "kanagawa-paper",
  "kiwi-mono",
  "kurokula",
  "lagom",
  "latex",
  "lavender-mist",
  "lemons-theme",
  "lesswrong",
  "light-bright",
  "listive",
  "lorens",
  "lumines",
  "lyt-mode",
  "mado-11",
  "mado-miniflow",
  "magicuser",
  "mammoth",
  "maple",
  "marathon",
  "material-3",
  "material-flat",
  "material-gruvbox",
  "material-ocean",
  "matrix",
  "meridian",
  "micro-mike",
  "midnight",
  "midnight-fjord",
  "minimal",
  "minimal-dark-coder",
  "minimal-dracula",
  "minimal-edge",
  "minimal-red",
  "minimal-resources",
  "minimalists-paradise",
  "mint-breeze",
  "mistymauve",
  "modern-genz-vibedose",
  "mono-black-monochrome-charcoal",
  "mono-high-contrast",
  "monochroyou",
  "monokai",
  "moonlight",
  "mulled-wine",
  "mushin",
  "muted-blue",
  "myst",
  "nebula",
  "neo",
  "neon-synthwave",
  "neovim",
  "neuborder",
  "neumorphism",
  "neutral-academia",
  "nier",
  "nightfox",
  "nightingale",
  "nobb",
  "noctilux",
  "noctis",
  "nord",
  "nordic",
  "northern-sky",
  "nostromo",
  "nota-limonada-light",
  "notation",
  "notation-2",
  "notswift",
  "novadust",
  "obsidian-boom",
  "obsidian-gruvbox",
  "obsidian-nord",
  "obsidian_ia",
  "obsidian_vibrant",
  "obsidianite",
  "obsidianotion",
  "obuntu",
  "oistnb",
  "old-world",
  "oldsidian-purple",
  "oledblack",
  "oliviers-theme",
  "omega",
  "onenice",
  "ono-sendai",
  "orange",
  "oreo",
  "origami",
  "origin",
  "osaka-jade",
  "overcast",
  "pale",
  "panic-mode",
  "parfait",
  "penumbra",
  "perso",
  "phoenix",
  "pine-forest-berry",
  "pink-topaz",
  "pisum",
  "planetary",
  "playground",
  "pln",
  "poimandres",
  "poimandres-extended",
  "polka",
  "pomme-notes",
  "powered-by-lancer",
  "powered-by-lancer-retouched",
  "primary",
  "prime",
  "prism",
  "proper-dark",
  "protocolblue",
  "prussian-blue",
  "publisher",
  "pure",
  "purple-aurora",
  "purple-owl",
  "pxld",
  "qlean",
  "quillcode",
  "radiance",
  "ravenloft",
  "red-graphite",
  "red-shadow",
  "redshift-oled-blue-light-filter",
  "refined-default",
  "reshi",
  "retro-windows",
  "retroma",
  "retronotes",
  "retroos-98",
  "reverie",
  "rezin",
  "ribbons",
  "rift",
  "rmaki",
  "robsi",
  "rose-pine",
  "rose-pine-2",
  "rose-pine-moon",
  "rose-red",
  "royal-velvet",
  "sad-machine-druid",
  "sakurajima",
  "salem",
  "sanctum",
  "sanctum-reborn",
  "sandover",
  "sandstorm",
  "sanguine",
  "sea-glass",
  "seamless-view",
  "sei",
  "serenity",
  "serif",
  "serika",
  "shade-sanctuary",
  "shadeflow",
  "shiba-inu",
  "shimmering-focus",
  "simple",
  "simple-color",
  "simplicity",
  "simply-colorful",
  "sodalite",
  "solarized",
  "soli-deo-gloria",
  "solitude",
  "soloing",
  "soothe",
  "space",
  "sparkling-day",
  "sparkling-night",
  "sparkling-wisdom",
  "spectrum",
  "spectrum-blue",
  "spectrumplus",
  "spring",
  "spy-terminal",
  "sqdthone",
  "strict",
  "subtlegold",
  "suddha",
  "sunbather",
  "synthwave",
  "synthwave-84",
  "terminal",
  "terminal2k",
  "terraflow",
  "theme-that-shall-not-be-named",
  "things",
  "things-3",
  "tiniri",
  "tokyo-night",
  "tokyo-night-simple",
  "tokyo-night-storm",
  "tomorrow",
  "tomorrow-night-bright",
  "toms-theme",
  "trace-labs",
  "transient",
  "transparent",
  "typewriter",
  "typomagical",
  "typora-vue",
  "tyrone-neon",
  "ukiyo",
  "ultra-lobster",
  "underwater",
  "ursa",
  "vanilla-amoled",
  "vanilla-amoled-color",
  "vanilla-palettes",
  "vauxhall",
  "velocity",
  "velvet-moon",
  "venom",
  "vercel-geist",
  "vermilion",
  "vesnea-vibe",
  "vesper",
  "vibrant",
  "vicious",
  "violet-evening",
  "virgo",
  "vortex",
  "w95",
  "wasp",
  "wikipedia",
  "wilcoxone",
  "willemstad",
  "winter-spices",
  "wiselight",
  "wombat",
  "wy-console",
  "wyrd",
  "yue",
  "zario",
  "zen",
  "zenburn",
];

const themeListDark = [
  "80s-neon",
  "abecedarium",
  "absolutegruv",
  "abyssal",
  "adrenaline",
  "adwaita",
  "aged-whisky",
  "allium",
  "amoled-serenity",
  "anuppuccin",
  "apatheia",
  "apex",
  "arcane",
  "arzaba",
  "atom",
  "atomus",
  "aura",
  "aura-dark",
  "aurora",
  "aurora-twilight",
  "autotape",
  "avatar",
  "ayu-light-mirage",
  "ayu-mirage",
  "azure",
  "base2tone",
  "baseline",
  "behave-dark",
  "big-bold",
  "black",
  "blackbird",
  "blood-rush",
  "blossom",
  "blue-topaz",
  "bolt",
  "border",
  "borealis",
  "bossidian",
  "brainhack",
  "brutalism",
  "buena-vista",
  "camena",
  "carbon",
  "cardstock",
  "catppuccin",
  "celestial-night",
  "charcoal",
  "chiaroscuroflow",
  "chime",
  "christmas",
  "cobalt-peacock",
  "cocoa",
  "coffee",
  "colored-candy",
  "comfort-color-dark",
  "comfort-dark",
  "comfort-smooth",
  "composer",
  "consolas",
  "covert",
  "creature",
  "creme-brulee",
  "cupertino",
  "cyber-glow",
  "cybertron",
  "cybertron-shifted",
  "dark-castle",
  "dark-clarity",
  "dark-graphite",
  "dark-graphite-pie",
  "dark-moss",
  "darkember",
  "darkyan",
  "dawn",
  "deep-submerge",
  "deeper-work",
  "default",
  "dekurai",
  "discordian",
  "dracula-for-obsidian",
  "dracula-gemini",
  "dracula-lyt",
  "dracula-official",
  "dracula-plus",
  "dracula-slim",
  "duality",
  "dune",
  "dunite",
  "dust",
  "dynamic-color",
  "ebullientworks",
  "eldritch",
  "elegance",
  "emerald-echo",
  "encore",
  "enhanced-file-explorer-tree",
  "ethereon",
  "evangelion",
  "everblush",
  "everforest",
  "everforest-enchanted",
  "everforest-spruce",
  "evergreen-shadow",
  "evilred",
  "faded",
  "fancy-a-story",
  "fastppuccin",
  "feather",
  "firefly",
  "flatcap",
  "flexcyon",
  "flexoki",
  "flexoki-warm",
  "focus",
  "frost",
  "garden-gnome-adwaita-gtk",
  "gdct-dark",
  "github-theme",
  "githubdhc",
  "gitsidian",
  "glass-robo",
  "golden-topaz",
  "green-nightmare",
  "gummy-revived",
  "hackthebox",
  "halcyon",
  "heboric",
  "hipstersmoothie",
  "hojicha",
  "hulk",
  "ia-writer",
  "ib-writer",
  "iceberg",
  "improved-potato",
  "ion",
  "iridium",
  "its-theme",
  "jotter",
  "kakano",
  "kanagawa",
  "kanagawa-paper",
  "kiwi-mono",
  "kurokula",
  "lagom",
  "latex",
  "lemons-theme",
  "lesswrong",
  "light-bright",
  "listive",
  "lorens",
  "lumines",
  "lyt-mode",
  "mado-11",
  "mado-miniflow",
  "magicuser",
  "mammoth",
  "maple",
  "marathon",
  "material-3",
  "material-flat",
  "material-gruvbox",
  "material-ocean",
  "matrix",
  "meridian",
  "micro-mike",
  "midnight",
  "midnight-fjord",
  "minimal",
  "minimal-dark-coder",
  "minimal-dracula",
  "minimal-edge",
  "minimal-red",
  "minimal-resources",
  "minimalists-paradise",
  "mistymauve",
  "modern-genz-vibedose",
  "mono-black-monochrome-charcoal",
  "mono-high-contrast",
  "monochroyou",
  "monokai",
  "moonlight",
  "mulled-wine",
  "mushin",
  "muted-blue",
  "myst",
  "nebula",
  "neo",
  "neon-synthwave",
  "neovim",
  "neumorphism",
  "neutral-academia",
  "nier",
  "nightfox",
  "nightingale",
  "nobb",
  "noctilux",
  "noctis",
  "nord",
  "nostromo",
  "notation",
  "notation-2",
  "notswift",
  "novadust",
  "obsidian-gruvbox",
  "obsidian-nord",
  "obsidianite",
  "obsidianotion",
  "obsidian_ia",
  "obsidian_vibrant",
  "obuntu",
  "oistnb",
  "old-world",
  "oldsidian-purple",
  "oledblack",
  "oliviers-theme",
  "omega",
  "onenice",
  "ono-sendai",
  "orange",
  "oreo",
  "origami",
  "origin",
  "osaka-jade",
  "overcast",
  "pale",
  "panic-mode",
  "penumbra",
  "phoenix",
  "pine-forest-berry",
  "pink-topaz",
  "pisum",
  "planetary",
  "playground",
  "pln",
  "poimandres",
  "poimandres-extended",
  "polka",
  "pomme-notes",
  "powered-by-lancer",
  "powered-by-lancer-retouched",
  "primary",
  "prime",
  "prism",
  "proper-dark",
  "protocolblue",
  "prussian-blue",
  "publisher",
  "pure",
  "purple-aurora",
  "purple-owl",
  "pxld",
  "qlean",
  "quillcode",
  "radiance",
  "ravenloft",
  "red-graphite",
  "red-shadow",
  "redshift-oled-blue-light-filter",
  "refined-default",
  "reshi",
  "retro-windows",
  "retroma",
  "retronotes",
  "retroos-98",
  "reverie",
  "rezin",
  "ribbons",
  "rift",
  "rmaki",
  "robsi",
  "rose-pine",
  "rose-pine-2",
  "rose-pine-moon",
  "rose-red",
  "royal-velvet",
  "sad-machine-druid",
  "sakurajima",
  "salem",
  "sanctum",
  "sanctum-reborn",
  "sandover",
  "sandstorm",
  "sanguine",
  "sea-glass",
  "seamless-view",
  "sei",
  "serenity",
  "serif",
  "serika",
  "shade-sanctuary",
  "shadeflow",
  "shiba-inu",
  "shimmering-focus",
  "simple",
  "simple-color",
  "simplicity",
  "simply-colorful",
  "sodalite",
  "solarized",
  "soli-deo-gloria",
  "solitude",
  "soloing",
  "soothe",
  "space",
  "sparkling-night",
  "sparkling-wisdom",
  "spectrum",
  "spectrum-blue",
  "spectrumplus",
  "spring",
  "spy-terminal",
  "sqdthone",
  "strict",
  "subtlegold",
  "suddha",
  "sunbather",
  "synthwave",
  "synthwave-84",
  "terminal",
  "terminal2k",
  "terraflow",
  "theme-that-shall-not-be-named",
  "things",
  "things-3",
  "tiniri",
  "tokyo-night",
  "tokyo-night-simple",
  "tokyo-night-storm",
  "tomorrow",
  "tomorrow-night-bright",
  "toms-theme",
  "trace-labs",
  "transient",
  "transparent",
  "typewriter",
  "typomagical",
  "typora-vue",
  "tyrone-neon",
  "ukiyo",
  "ultra-lobster",
  "underwater",
  "ursa",
  "vanilla-amoled",
  "vanilla-amoled-color",
  "vanilla-palettes",
  "vauxhall",
  "velocity",
  "velvet-moon",
  "venom",
  "vercel-geist",
  "vermilion",
  "vesnea-vibe",
  "vesper",
  "vibrant",
  "vicious",
  "violet-evening",
  "virgo",
  "vortex",
  "wasp",
  "wikipedia",
  "wilcoxone",
  "willemstad",
  "wombat",
  "wy-console",
  "wyrd",
  "yue",
  "zario",
  "zen",
  "zenburn",
];

const themeListLight = [
  "abate",
  "abecedarium",
  "abyssal",
  "adrenaline",
  "adwaita",
  "agate",
  "al-dente",
  "allium",
  "anuppuccin",
  "apex",
  "arzaba",
  "atom",
  "aura",
  "aurora-twilight",
  "autotape",
  "ayu-light-mirage",
  "azure",
  "baseline",
  "big-bold",
  "blood-rush",
  "blue-topaz",
  "bolt",
  "border",
  "borealis",
  "brainhack",
  "buena-vista",
  "camena",
  "carbon",
  "cardstock",
  "catppuccin",
  "chiaroscuroflow",
  "chime",
  "coffee",
  "colored-candy",
  "comfort",
  "composer",
  "creme-brulee",
  "cupertino",
  "cyber-glow",
  "dark-clarity",
  "dark-graphite-pie",
  "darkember",
  "dashboard",
  "dawn",
  "dayspring",
  "default",
  "duality",
  "dune",
  "dunite",
  "dynamic-color",
  "ebullientworks",
  "elegance",
  "emerald-echo",
  "encore",
  "enhanced-file-explorer-tree",
  "ethereon",
  "everforest",
  "everforest-enchanted",
  "everforest-spruce",
  "fancy-a-story",
  "fastppuccin",
  "feather",
  "flexoki",
  "flexoki-warm",
  "frost",
  "fusion",
  "future",
  "garden-gnome-adwaita-gtk",
  "gdct",
  "github-theme",
  "gitsidian",
  "golden-topaz",
  "gummy-revived",
  "handwriting-kalam",
  "heboric",
  "ia-writer",
  "ib-writer",
  "improved-potato",
  "ink",
  "iridium",
  "its-theme",
  "jotter",
  "kakano",
  "kanagawa",
  "kanagawa-paper",
  "kiwi-mono",
  "lagom",
  "latex",
  "lavender-mist",
  "lesswrong",
  "light-bright",
  "listive",
  "lumines",
  "mado-11",
  "mado-miniflow",
  "magicuser",
  "maple",
  "marathon",
  "material-3",
  "material-flat",
  "material-gruvbox",
  "meridian",
  "minimal",
  "minimal-dracula",
  "minimal-edge",
  "minimalists-paradise",
  "mint-breeze",
  "mistymauve",
  "modern-genz-vibedose",
  "mono-high-contrast",
  "monochroyou",
  "monokai",
  "moonlight",
  "mulled-wine",
  "mushin",
  "myst",
  "neo",
  "neovim",
  "neuborder",
  "neumorphism",
  "neutral-academia",
  "nightfox",
  "nord",
  "nordic",
  "northern-sky",
  "nota-limonada-light",
  "notation",
  "notation-2",
  "notswift",
  "obsidian-boom",
  "obsidian-gruvbox",
  "obsidian-nord",
  "obsidianotion",
  "obsidian_ia",
  "obuntu",
  "oistnb",
  "oliviers-theme",
  "onenice",
  "ono-sendai",
  "orange",
  "oreo",
  "origami",
  "origin",
  "osaka-jade",
  "pale",
  "parfait",
  "penumbra",
  "perso",
  "phoenix",
  "pine-forest-berry",
  "pink-topaz",
  "planetary",
  "pln",
  "poimandres-extended",
  "polka",
  "pomme-notes",
  "powered-by-lancer",
  "powered-by-lancer-retouched",
  "primary",
  "prime",
  "prism",
  "proper-dark",
  "publisher",
  "pure",
  "pxld",
  "qlean",
  "quillcode",
  "radiance",
  "ravenloft",
  "red-graphite",
  "refined-default",
  "reshi",
  "retro-windows",
  "retroma",
  "retronotes",
  "retroos-98",
  "reverie",
  "ribbons",
  "robsi",
  "rose-pine",
  "rose-pine-2",
  "royal-velvet",
  "sad-machine-druid",
  "salem",
  "sanctum",
  "sanctum-reborn",
  "sandover",
  "sandstorm",
  "sei",
  "serenity",
  "serif",
  "serika",
  "shade-sanctuary",
  "shadeflow",
  "shiba-inu",
  "shimmering-focus",
  "simple",
  "simplicity",
  "simply-colorful",
  "solarized",
  "soli-deo-gloria",
  "soloing",
  "soothe",
  "sparkling-day",
  "sparkling-night",
  "sparkling-wisdom",
  "spectrum",
  "spring",
  "spy-terminal",
  "sqdthone",
  "subtlegold",
  "suddha",
  "sunbather",
  "terminal2k",
  "terraflow",
  "things",
  "things-3",
  "tiniri",
  "tokyo-night",
  "toms-theme",
  "transparent",
  "typewriter",
  "typomagical",
  "typora-vue",
  "tyrone-neon",
  "ukiyo",
  "ultra-lobster",
  "underwater",
  "ursa",
  "vanilla-palettes",
  "vauxhall",
  "velocity",
  "vercel-geist",
  "vermilion",
  "vesnea-vibe",
  "vesper",
  "vicious",
  "virgo",
  "vortex",
  "w95",
  "wasp",
  "wikipedia",
  "willemstad",
  "winter-spices",
  "wiselight",
  "wy-console",
  "wyrd",
  "yue",
  "zario",
  "zen",
];

function hasTheme() {
  return themeList.includes(
    window.location.pathname.startsWith("/")
      ? window.location.pathname.slice(1).toLowerCase()
      : window.location.pathname.toLowerCase(),
  );
}

function getStylesheetForCurrentPage() {
  const pathname = window.location.pathname.toLowerCase();
  const theme = pathname.startsWith("/")
    ? pathname.slice(1).toLowerCase()
    : pathname.toLowerCase();
  ensureModeMatchesTheme(theme);
  return `https://cdn.jsdelivr.net/gh/saberzero1/quartz-themes@refs/heads/develop/themes/${theme}/publish.css`;
}

function injectStyleElement(css) {
  const styleTag = document.getElementById("dynamic-theme-style");
  let style = null;
  if (!styleTag) {
    style = document.createElement("style");
    style.id = "dynamic-theme-style";
    style.textContent = css;
    document.head.appendChild(style);
  } else {
    style = styleTag;
    style.textContent = css;
  }
}

function ensureModeMatchesTheme(theme) {
  const isDark = document
    .querySelector("body")
    .classList.value.includes("theme-dark");
  const themeSupportsDark = themeListDark.includes(theme);
  const themeSupportsLight = themeListLight.includes(theme);

  if (isDark && !themeSupportsDark) {
    this.app.setTheme("light");
  } else if (!isDark && !themeSupportsLight) {
    this.app.setTheme("dark");
  }
}

async function fetchStylesheet(url) {
  fetch(url)
    .then((response) => {
      if (!response.ok) throw new Error("Network response was not ok");
      return response.text();
    })
    .then((css) => {
      injectStyleElement(css);
    })
    .catch((error) => {
      console.error("Failed to load CSS:", error);
    });
}

async function applyThemeStylesheet() {
  if (hasTheme()) {
    const stylesheetUrl = getStylesheetForCurrentPage();
    await fetchStylesheet(stylesheetUrl);
  } else {
    injectStyleElement("");
  }
}

(function (history) {
  const pushState = history.pushState;
  const replaceState = history.replaceState;

  function onUrlChange() {
    console.log("URL changed to:", location.href);
    applyThemeStylesheet();
  }

  history.pushState = function (state) {
    const result = pushState.apply(history, arguments);
    onUrlChange();
    return result;
  };

  history.replaceState = function (state) {
    const result = replaceState.apply(history, arguments);
    onUrlChange();
    return result;
  };

  window.addEventListener("popstate", onUrlChange); // Back/forward buttons
})(window.history);

applyThemeStylesheet();
